{% extends "./_base.njk" %}

{% if landing %}
  {% set htmlClasses = 'app-break-out-container' %}
{% endif %}

{% block pageTitle %}
  {{- pageTitle -}}
{% endblock %}

{% block header %}
  {{ super() }}
  {% from "service-navigation.njk" import appServiceNavigation %}
  {% if collections.serviceNavigationPages | length %}
    {{ appServiceNavigation({
      pages: collections.serviceNavigationPages,
      renderedPageUrl: page.url
    })}}
  {% endif %}
{% endblock %}

{% set hasSidebarNavigation = sidebarNavigationRoot.data.children | length %}

{% block beforeContent %}
  {{ super() }}

  <div class="{{ ['app-page-wrapper', 'app-page-wrapper--no-navigation' if not hasSidebarNavigation] | select(truthy) | join(' ')}}">
    {% if hasSidebarNavigation %}
      <nav class="app-chapter-navigation" aria-labelledby="side-navigation">
        <h2 class="govuk-heading-s govuk-!-margin-bottom-1{{ ' govuk-!-margin-top-6' if landing else '' }}" id="side-navigation">In this section</h2>
        {% from "link-list.njk" import appLinkList %}
        {{ appLinkList({
          pages: sidebarNavigationRoot.data.children,
          renderedPageUrl: page.url
        })}}
      </nav>
    {% endif %}
    {%  set contentClasses = 'app-content app-content--section-' + page.fileSlug  if landing else 'app-content' %}
    <div class="{{ contentClasses }}">
      {% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}

      {# Some pages, like test pages, don't have ancestors #}
      {% if ancestors.length %}
        {%  set breadcrumbClasses = 'app-breadcrumbs govuk-breadcrumbs--inverse app-breadcrumbs--landing app-breadcrumbs--landing-' + page.fileSlug  if landing else 'app-breadcrumbs' %}
        {{
          govukBreadcrumbs({
            classes: breadcrumbClasses,
            items: ancestors | asBreadcrumbItems
          })
        }}
      {% endif %}

      {#
        To avoid re-producing GOV.UK Frontend's markup for the `main` block
        the grid row and column will be closed at the end of the `main` block
      #}
{% endblock %}

{% block content %}
  {% if landing %}
    <div class="app-landing">
      <div class="app-landing__hero">
        <div class="app-landing__hero-container">
          <h1 class="govuk-heading-xl">{{title}}</h1>
          <p class="govuk-body-l">{{ lead }}</p>
        </div>
      </div>
    </div>
  {% else %}
    <h1 class="govuk-heading-xl">{{title}}</h1>
  {% endif %}
  {{ content | safe }}

  {# Render the list of pages under each chapter after the content
    as a fallback for mobile navigation if JavaScript does not load #}
  {% if isSidebarNavigationRoot and hasSidebarNavigation %}
    <nav class="app-chapter-navigation--mobile-fallback" aria-labelledby="chapter-navigation">
      <h2 class="govuk-heading-l" id="chapter-navigation">Pages in {{title}}</h2>
      {% from "link-list.njk" import appLinkList %}
      {{ appLinkList({
        pages: sidebarNavigationRoot.data.children,
        renderedPageUrl: page.url
      })}}
    </nav>
  {% endif %}
{% endblock %}

{% block main %}
    {{super()}}
    </div>
  </div>
{% endblock %}

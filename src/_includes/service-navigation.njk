{% from "govuk/components/service-navigation/macro.njk" import govukServiceNavigation %}
{% from "link-list.njk" import appLinkList %}

{% macro appServiceNavigation(params) %}

{%- set navigation = [] %}
{%- for page in params.pages %}

  {% set subNavigationHtml %}
    <template>
      {{ appLinkList({
        pages: page.data.children,
        renderedPageUrl: params.renderedPageUrl,
        classes: 'app-mobile-navigation-section__subnav',
        itemClasses: 'app-mobile-navigation-section__item',
        linkClasses: 'govuk-service-navigation__link'
      }) }}
    </template>
  {% endset %}

  {% set navigation = navigation.concat([
    page | asServiceNavigationItem({
      renderedPageUrl: params.renderedPageUrl,
      html: page.data.title + subNavigationHtml,
      attributes: {
        "data-module": "app-mobile-navigation-section"
      }
    })
  ])%}
{% endfor %}

{{ govukServiceNavigation({
  navigation: navigation,
  navigationClasses: 'app-service-navigation__wrapper'
}) }}

{% endmacro %}
